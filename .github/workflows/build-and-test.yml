name: Build

on:
    push:
        branches:
            - master

jobs:
    install:
        runs-on: ubuntu-22.04

        steps:
        - name: Checkout git repo
          uses: actions/checkout@v3

        - name: Install Node and NPM
          uses: actions/setup-node@v3
          with:
            node-version: 16
            cache: npm

        - name: Install and build
          run: |
            npm install
        
        - name: Build Frontend
          run: npm run build

        - name: "Run Tests"
          run: npm run test

    cypress:
        runs-on: ubuntu-22.04
        needs: install
        
        steps:
        - name: Set up Docker
          run: |
            sudo apt-get update
            sudo apt-get install -y docker.io

        - name: Run Cypress tests
          run: |
            docker run -v $PWD:/e2e -w /e2e cypress/included:8.4.0